{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "data/receipt",
  "title": "Receipt",
  "description": "A Versa itemized receipt",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "header",
    "itemization",
    "actions",
    "payments"
  ],
  "properties": {
    "schema_version": {
      "title": "SchemaVersion",
      "type": "string",
      "minLength": 5,
      "maxLength": 14,
      "pattern": "^(?:0|[1-9]\\d*)\\.(?:0|[1-9]\\d*)\\.(?:0|[1-9]\\d*)$"
    },
    "header": {
      "$ref": "#/$defs/header"
    },
    "itemization": {
      "$ref": "#/$defs/itemization"
    },
    "actions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/action"
      }
    },
    "payments": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/payment"
      }
    }
  },
  "$defs": {
    "action": {
      "title": "Action",
      "type": "object",
      "required": ["name", "url"],
      "properties": {
        "name": {
          "type": "string"
        },
        "url": {
          "type": "string",
          "format": "uri"
        }
      }
    },
    "car_rental": {
      "title": "CarRental",
      "type": "object",
      "required": [
        "rental_at",
        "return_at",
        "rental_location",
        "return_location",
        "driver_name",
        "odometer_reading_in",
        "odometer_reading_out",
        "items",
        "invoice_level_adjustments"
      ],
      "properties": {
        "rental_at": {
          "type": "integer"
        },
        "return_at": {
          "type": "integer"
        },
        "rental_location": {
          "$ref": "#/$defs/place"
        },
        "return_location": {
          "$ref": "#/$defs/place"
        },
        "vehicle": {
          "type": ["object", "null"],
          "required": ["description", "image"],
          "properties": {
            "description": {
              "type": "string"
            },
            "image": {
              "type": ["string", "null"],
              "format": "uri"
            }
          }
        },
        "driver_name": {
          "type": "string"
        },
        "odometer_reading_in": {
          "type": "integer"
        },
        "odometer_reading_out": {
          "type": "integer"
        },
        "items": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/item"
          }
        },
        "invoice_level_adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "customer": {
      "title": "Customer",
      "type": "object",
      "required": ["name", "email", "address", "phone", "metadata"],
      "properties": {
        "name": {
          "type": "string"
        },
        "email": {
          "type": ["string", "null"],
          "format": "email",
          "minLength": 6,
          "maxLength": 127
        },
        "address": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/$defs/address"
            }
          ]
        },
        "phone": {
          "type": ["string", "null"]
        },
        "metadata": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/metadatum"
          }
        }
      }
    },
    "flight": {
      "title": "Flight",
      "type": "object",
      "required": ["tickets", "invoice_level_adjustments"],
      "properties": {
        "tickets": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/flight_ticket"
          }
        },
        "itinerary_locator": {
          "type": ["null", "string"]
        },
        "invoice_level_adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "flight_segment": {
      "title": "FlightSegment",
      "type": "object",
      "required": [
        "fare",
        "departure_airport_code",
        "arrival_airport_code",
        "departure_at",
        "arrival_at",
        "departure_tz",
        "arrival_tz",
        "flight_number",
        "class_of_service",
        "taxes",
        "adjustments"
      ],
      "properties": {
        "fare": {
          "type": "integer"
        },
        "departure_airport_code": {
          "type": "string"
        },
        "arrival_airport_code": {
          "type": "string"
        },
        "departure_at": {
          "type": ["null", "integer"]
        },
        "arrival_at": {
          "type": ["null", "integer"]
        },
        "departure_tz": {
          "type": ["null", "string"]
        },
        "arrival_tz": {
          "type": ["null", "string"]
        },
        "flight_number": {
          "type": ["null", "string"]
        },
        "class_of_service": {
          "type": ["null", "string"]
        },
        "taxes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/tax"
          }
        },
        "adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "flight_ticket": {
      "title": "FlightTicket",
      "type": "object",
      "required": ["segments"],
      "properties": {
        "segments": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/flight_segment"
          }
        },
        "number": {
          "type": ["null", "string"]
        },
        "record_locator": {
          "type": ["null", "string"]
        },
        "passenger": {
          "type": ["null", "string"]
        }
      }
    },
    "header": {
      "title": "Header",
      "type": "object",
      "additionalProperties": false,
      "required": ["currency", "total", "subtotal", "paid", "invoiced_at"],
      "properties": {
        "invoice_number": {
          "type": ["string", "null"]
        },
        "currency": {
          "title": "Currency",
          "description": "ISO 4217 currency code",
          "type": "string",
          "enum": ["usd", "eur", "jpy", "gbp", "aud", "cad", "chf", "cnh"]
        },
        "total": {
          "type": "integer"
        },
        "subtotal": {
          "type": "integer"
        },
        "paid": {
          "type": "integer"
        },
        "invoiced_at": {
          "type": "integer"
        },
        "mcc": {
          "type": ["string", "null"]
        },
        "third_party": {
          "type": ["object", "null"],
          "additionalProperties": false,
          "required": ["first_party_relation", "make_primary", "merchant"],
          "properties": {
            "first_party_relation": {
              "type": "string",
              "enum": [
                "bnpl",
                "delivery_service",
                "marketplace",
                "payment_processor",
                "platform",
                "point_of_sale"
              ]
            },
            "make_primary": {
              "description": "Determines whether the merchant or third party gets top billing on the receipt",
              "type": "boolean"
            },
            "merchant": {
              "$ref": "#/$defs/org"
            }
          }
        },
        "customer": {
          "oneOf": [
            {
              "$ref": "#/$defs/customer"
            },
            {
              "type": "null"
            }
          ]
        },
        "location": {
          "oneOf": [
            {
              "$ref": "#/$defs/place"
            },
            {
              "type": "null"
            }
          ]
        },
        "invoice_asset_id": {
          "type": ["string", "null"]
        },
        "receipt_asset_id": {
          "type": ["string", "null"]
        }
      }
    },
    "itemization": {
      "title": "Itemization",
      "type": "object",
      "required": [],
      "properties": {
        "general": {
          "oneOf": [
            {
              "$ref": "#/$defs/general_itemization"
            },
            {
              "type": "null"
            }
          ]
        },
        "lodging": {
          "oneOf": [
            {
              "$ref": "#/$defs/lodging"
            },
            {
              "type": "null"
            }
          ]
        },
        "ecommerce": {
          "oneOf": [
            {
              "$ref": "#/$defs/ecommerce"
            },
            {
              "type": "null"
            }
          ]
        },
        "car_rental": {
          "oneOf": [
            {
              "$ref": "#/$defs/car_rental"
            },
            {
              "type": "null"
            }
          ]
        },
        "transit_route": {
          "oneOf": [
            {
              "$ref": "#/$defs/transit_route"
            },
            {
              "type": "null"
            }
          ]
        },
        "subscription": {
          "oneOf": [
            {
              "$ref": "#/$defs/subscription"
            },
            {
              "type": "null"
            }
          ]
        },
        "flight": {
          "oneOf": [
            {
              "$ref": "#/$defs/flight"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "ecommerce": {
      "title": "Ecommerce",
      "type": "object",
      "required": [
        "shipments",
        "invoice_level_line_items",
        "invoice_level_adjustments"
      ],
      "properties": {
        "shipments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/shipment"
          }
        },
        "invoice_level_line_items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/item"
          }
        },
        "invoice_level_adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "general_itemization": {
      "title": "GeneralItemization",
      "type": "object",
      "required": ["line_items", "invoice_level_adjustments"],
      "properties": {
        "line_items": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/item"
          }
        },
        "invoice_level_adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "lodging": {
      "title": "Lodging",
      "type": "object",
      "required": [
        "check_in",
        "check_out",
        "invoice_level_adjustments",
        "items",
        "location"
      ],
      "properties": {
        "check_in": {
          "type": "integer"
        },
        "check_out": {
          "type": "integer"
        },
        "location": {
          "$ref": "#/$defs/place"
        },
        "items": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/item"
          }
        },
        "room": {
          "type": ["null", "string"]
        },
        "guests": {
          "type": ["null", "string"]
        },
        "metadata": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/metadatum"
          }
        },
        "invoice_level_adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "org": {
      "title": "Org",
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string"
        },
        "brand_color": {
          "oneOf": [
            {
              "description": "Hex color",
              "type": "string",
              "pattern": "^#?([a-f0-9]{6}|[a-f0-9]{3})$"
            },
            {
              "type": "null"
            }
          ]
        },
        "legal_name": {
          "type": ["string", "null"]
        },
        "logo": {
          "type": ["string", "null"],
          "format": "uri"
        },
        "website": {
          "type": ["string", "null"],
          "format": "hostname"
        },
        "vat_number": {
          "type": ["string", "null"]
        },
        "address": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/$defs/address"
            }
          ]
        }
      }
    },
    "address": {
      "title": "Address",
      "type": "object",
      "required": [
        "street_address",
        "city",
        "region",
        "country",
        "postal_code",
        "lat",
        "lon",
        "tz"
      ],
      "properties": {
        "street_address": {
          "type": ["string", "null"]
        },
        "city": {
          "type": ["string", "null"]
        },
        "region": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string",
              "minLength": 2,
              "maxLength": 2
            }
          ]
        },
        "country": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string",
              "minLength": 2,
              "maxLength": 2
            }
          ]
        },
        "postal_code": {
          "type": ["string", "null"]
        },
        "lat": {
          "oneOf": [
            {
              "type": "number",
              "minimum": -90,
              "maximum": 90
            },
            {
              "type": "null"
            }
          ]
        },
        "lon": {
          "oneOf": [
            {
              "type": "number",
              "minimum": -180,
              "maximum": 180
            },
            {
              "type": "null"
            }
          ]
        },
        "tz": {
          "type": ["string", "null"]
        }
      }
    },
    "place": {
      "title": "Place",
      "description": "The physical or online location where a transaction occurred",
      "type": "object",
      "required": [
        "name",
        "address",
        "phone",
        "url",
        "google_place_id",
        "image"
      ],
      "properties": {
        "name": {
          "type": ["string", "null"]
        },
        "address": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/$defs/address"
            }
          ]
        },
        "phone": {
          "type": ["string", "null"]
        },
        "url": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string",
              "format": "uri"
            }
          ]
        },
        "google_place_id": {
          "type": ["string", "null"]
        },
        "image": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string",
              "format": "uri"
            }
          ]
        }
      }
    },
    "subscription_item": {
      "title": "SubscriptionItem",
      "type": "object",
      "required": [
        "subscription_type",
        "description",
        "taxes",
        "metadata",
        "adjustments",
        "subtotal"
      ],
      "properties": {
        "subtotal": {
          "type": "integer"
        },
        "subscription_type": {
          "title": "SubscriptionType",
          "type": "string",
          "enum": ["one_time", "recurring"]
        },
        "description": {
          "type": "string"
        },
        "interval": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "title": "Interval",
              "type": "string",
              "enum": ["day", "week", "month", "year"]
            }
          ]
        },
        "interval_count": {
          "type": ["integer", "null"]
        },
        "current_period_start": {
          "type": ["integer", "null"]
        },
        "current_period_end": {
          "type": ["integer", "null"]
        },
        "quantity": {
          "type": ["number", "null"]
        },
        "unit_cost": {
          "type": ["number", "null"]
        },
        "taxes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/tax"
          }
        },
        "metadata": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/metadatum"
          }
        },
        "adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "metadatum": {
      "title": "Metadatum",
      "type": "object",
      "required": ["key", "value"],
      "properties": {
        "key": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      }
    },
    "adjustment": {
      "title": "Adjustment",
      "type": "object",
      "required": ["amount", "name", "adjustment_type", "rate"],
      "properties": {
        "amount": {
          "type": "integer"
        },
        "name": {
          "type": ["null", "string"]
        },
        "adjustment_type": {
          "title": "AdjustmentType",
          "type": "string",
          "enum": ["discount", "tip", "fee", "other"]
        },
        "rate": {
          "type": ["null", "number"]
        }
      }
    },
    "shipment": {
      "title": "Shipment",
      "type": "object",
      "required": [
        "items"
      ],
      "properties": {
        "items": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/item"
          }
        },
        "tracking_number": {
          "type": ["string", "null"]
        },
        "expected_delivery_at": {
          "type": ["integer", "null"]
        },
        "shipment_status": {
          "type": ["string", "null"],
          "enum": ["prep", "in_transit", "delivered"]
        },
        "destination_address": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/$defs/address"
            }
          ]
        }
      }
    },
    "subscription": {
      "title": "Subscription",
      "type": "object",
      "required": ["subscription_items", "invoice_level_adjustments"],
      "properties": {
        "subscription_items": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/subscription_item"
          }
        },
        "invoice_level_adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "tax": {
      "title": "Tax",
      "type": "object",
      "required": ["amount", "rate", "name"],
      "properties": {
        "amount": {
          "type": "integer"
        },
        "rate": {
          "type": ["number", "null"]
        },
        "name": {
          "type": "string"
        }
      }
    },
    "transit_route": {
      "title": "TransitRoute",
      "type": "object",
      "required": ["transit_route_items", "invoice_level_adjustments"],
      "properties": {
        "transit_route_items": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/transit_route_item"
          }
        },
        "invoice_level_adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "transit_route_item": {
      "title": "TransitRouteItem",
      "type": "object",
      "required": ["fare", "taxes", "metadata", "adjustments"],
      "properties": {
        "departure_location": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/$defs/place"
            }
          ]
        },
        "arrival_location": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/$defs/place"
            }
          ]
        },
        "departure_at": {
          "type": ["integer", "null"]
        },
        "arrival_at": {
          "type": ["integer", "null"]
        },
        "polyline": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string"
            }
          ]
        },
        "adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        },
        "taxes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/tax"
          }
        },
        "metadata": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/metadatum"
          }
        },
        "fare": {
          "type": ["integer"]
        },
        "passenger": {
          "type": ["string", "null"]
        },
        "mode": {
          "type": ["string", "null"],
          "enum": ["car", "taxi", "rail", "bus", "ferry", "other"]
        }
      }
    },
    "item": {
      "title": "Item",
      "type": "object",
      "required": ["description", "subtotal"],
      "properties": {
        "date": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string",
              "format": "date"
            }
          ]
        },
        "description": {
          "type": "string"
        },
        "subtotal": {
          "type": "integer"
        },
        "quantity": {
          "type": ["null", "number"]
        },
        "unit_cost": {
          "type": ["null", "integer"]
        },
        "unit": {
          "type": ["null", "string"]
        },
        "unspsc": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string",
              "pattern": "^\\d{8}$"
            }
          ]
        },
        "taxes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/tax"
          }
        },
        "metadata": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/metadatum"
          }
        },
        "product_image": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string",
              "format": "uri"
            }
          ]
        },
        "group": {
          "type": ["null", "string"]
        },
        "url": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string",
              "format": "uri"
            }
          ]
        },
        "adjustments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/adjustment"
          }
        }
      }
    },
    "payment": {
      "title": "Payment",
      "type": "object",
      "required": ["amount", "paid_at", "payment_type"],
      "properties": {
        "amount": {
          "type": "integer"
        },
        "paid_at": {
          "type": "integer"
        },
        "payment_type": {
          "type": "string",
          "enum": ["card", "ach"]
        },
        "card_payment": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/$defs/card_payment"
            }
          ]
        },
        "ach_payment": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/$defs/ach_payment"
            }
          ]
        }
      }
    },
    "card_payment": {
      "title": "CardPayment",
      "type": "object",
      "required": ["last_four", "network"],
      "properties": {
        "last_four": {
          "type": "string"
        },
        "network": {
          "type": ["string", "null"],
          "enum": [
            "amex",
            "diners",
            "discover",
            "eftpos_au",
            "jcb",
            "mastercard",
            "unionpay",
            "visa"
          ]
        }
      }
    },
    "ach_payment": {
      "title": "AchPayment",
      "type": "object",
      "required": ["routing_number"],
      "properties": {
        "routing_number": {
          "type": "string"
        }
      }
    },
    "doc": {
      "title": "Doc",
      "type": "object",
      "required": ["title", "body"],
      "properties": {
        "title": {
          "type": "string"
        },
        "body": {
          "type": "string"
        }
      }
    }
  }
}
